/**
 * @file Firestore Security Rules
 * @description This ruleset provides a highly permissive security posture, granting essentially full access to all data.
 *
 * Core Philosophy:
 * This configuration prioritizes ease of development and testing. All authenticated users have read and write access to all collections.
 *
 * Data Structure:
 * The database is structured with top-level collections for `users`, `team`, `chats`, and `groups`.  The `users` collection stores individual user profiles,
 * the `team` collection stores profiles of team members, `chats` stores 1-on-1 chat sessions, `groups` stores group chat information.
 * User-specific data like contacts are stored in subcollections under each user's document. Chat messages are stored in subcollections under their respective chats or groups.
 *
 * Key Security Decisions:
 * - All authenticated users can read any data.
 * - All authenticated users can create, update, and delete any data.
 *
 * WARNING: This ruleset is NOT suitable for production environments. It is designed for prototyping and testing purposes only.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows any authenticated user to read and write user profiles.
     * @path /users/{userId}
     * @allow (create, update, delete) - Any authenticated user can create, update, or delete a user profile.
     * @allow (get, list) - Any authenticated user can read user profiles.
     * @deny (create, update, delete) - Never
     * @principle Grants full access to all user profiles for all authenticated users.
     */
    match /users/{userId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to read and write team member profiles.
     * @path /team/{userId}
     * @allow (create, update, delete) - Any authenticated user can create, update, or delete a team member profile.
     * @allow (get, list) - Any authenticated user can read team member profiles.
     * @deny (create, update, delete) - Never
     * @principle Grants full access to all team profiles for all authenticated users.
     */
    match /team/{userId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to read and write chat session information.
     * @path /chats/{chatId}
     * @allow (create, update, delete) - Any authenticated user can create, update, or delete a chat session.
     * @allow (get, list) - Any authenticated user can read chat session information.
     * @deny (create, update, delete) - Never
     * @principle Grants full access to all chat sessions for all authenticated users.
     */
    match /chats/{chatId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isSignedIn();

      /**
       * @description Allows any authenticated user to read and write messages within a chat session.
       * @path /chats/{chatId}/messages/{messageId}
       * @allow (create, update, delete) - Any authenticated user can create, update, or delete messages within a chat session.
       * @allow (get, list) - Any authenticated user can read messages within a chat session.
       * @deny (create, update, delete) - Never
       * @principle Grants full access to all chat messages for all authenticated users.
       */
      match /messages/{messageId} {
        allow get, list: if isSignedIn();
        allow create, update, delete: if isSignedIn();
      }
    }

    /**
     * @description Allows any authenticated user to read and write contact information for a user.
     * @path /users/{userId}/contacts/{contactId}
     * @allow (create, update, delete) - Any authenticated user can create, update, or delete contact information for a user.
     * @allow (get, list) - Any authenticated user can read contact information for a user.
     * @deny (create, update, delete) - Never
     * @principle Grants full access to all user contacts for all authenticated users.
     */
    match /users/{userId}/contacts/{contactId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to read and write group chat information.
     * @path /groups/{groupId}
     * @allow (create, update, delete) - Any authenticated user can create, update, or delete a group chat.
     * @allow (get, list) - Any authenticated user can read group chat information.
     * @deny (create, update, delete) - Never
     * @principle Grants full access to all group chats for all authenticated users.
     */
    match /groups/{groupId} {
      allow get, list: if isSignedIn();
      allow create, update, delete: if isSignedIn();

       /**
        * @description Allows any authenticated user to read and write messages within a group chat session.
        * @path /groups/{groupId}/messages/{messageId}
        * @allow (create, update, delete) - Any authenticated user can create, update, or delete messages within a group chat session.
        * @allow (get, list) - Any authenticated user can read messages within a group chat session.
        * @deny (create, update, delete) - Never
        * @principle Grants full access to all group chat messages for all authenticated users.
        */
      match /messages/{messageId} {
        allow get, list: if isSignedIn();
        allow create, update, delete: if isSignedIn();
      }
    }

    function isSignedIn() {
        return request.auth != null;
    }
  }
}