/**
 * @fileOverview Firestore Security Rules for Secure Talk application.
 *
 * Core Philosophy:
 * This ruleset prioritizes ease of access and rapid prototyping by granting broad read and write permissions to authenticated users.
 * This is a temporary measure for development and should be replaced with more restrictive rules in a production environment.
 *
 * Data Structure:
 * - /users/{userId}: Stores user profiles.
 * - /chats/{chatId}: Stores chat session metadata.
 * - /chats/{chatId}/messages/{messageId}: Stores individual messages within a chat.
 * - /users/{userId}/contacts/{contactId}: Stores user contact lists.
 *
 * Key Security Decisions:
 * - Authenticated users have full read and write access to all collections.
 * - No schema validation is performed in this prototyping phase.
 *
 * WARNING: These rules are insecure and should NOT be used in production.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Allows any authenticated user to read and write user profiles.
     * @path /users/{userId}
     * @allow (read, write): If the user is authenticated.
     * @deny Never.
     * @principle Grants full access to user profiles for authenticated users.
     */
    match /users/{userId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to read and write chat session metadata.
     * @path /chats/{chatId}
     * @allow (read, write): If the user is authenticated.
     * @deny Never.
     * @principle Grants full access to chat metadata for authenticated users.
     */
    match /chats/{chatId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to read and write messages within a chat session.
     * @path /chats/{chatId}/messages/{messageId}
     * @allow (read, write): If the user is authenticated.
     * @deny Never.
     * @principle Grants full access to messages for authenticated users.
     */
    match /chats/{chatId}/messages/{messageId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Allows any authenticated user to read and write contact information for a user.
     * @path /users/{userId}/contacts/{contactId}
     * @allow (read, write): If the user is authenticated.
     * @deny Never.
     * @principle Grants full access to contact information for authenticated users.
     */
    match /users/{userId}/contacts/{contactId} {
      allow get: if isSignedIn();
      allow list: if isSignedIn();
      allow create: if isSignedIn();
      allow update: if isSignedIn();
      allow delete: if isSignedIn();
    }

    /**
     * @description Helper function to check if a user is signed in.
     * @returns {boolean} True if the user is signed in, false otherwise.
     */
    function isSignedIn() {
      return request.auth != null;
    }
  }
}